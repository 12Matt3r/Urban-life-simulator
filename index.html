<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Urban Life Simulator - Integrated Client</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root {
    --bg: #0b0b0d; --panel: #111216; --ink: #e9f1ff; --muted: #98a2b3;
    --acc: #00ffa2; --danger: #ff6b6b; --line: #1c1f26;
  }
  html, body { height: 100%; background: var(--bg); color: var(--ink); margin: 0; font: 14px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
  .wrap { padding: 24px; max-width: 980px; margin: 0 auto; }
  h1 { font-size: 20px; margin: 0 0 8px; }
  p { color: var(--muted); margin: 0 0 12px; }
  .card { background: var(--panel); border: 1px solid var(--line); border-radius: 12px; padding: 16px; }
  #game-container { position: relative; width: 100%; height: 480px; background-color: #000; border-radius: 12px; margin-top: 24px; overflow: hidden; border: 1px solid var(--line); }
  #hud-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
  #overlay-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
  .uls-dev-btn { background:#1f2633; border:1px solid #2b3344; color:#dfe5f2; border-radius:5px; padding:6px 8px; cursor:pointer; font-size: 11px; }
  .uls-dev-btn:hover { background:#242d3e; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Urban Life Simulator</h1>
    <div class="card">
      <p>The integrated game client is loading. If you have the `dev=1` flag in the URL, the test harness will appear below.</p>
    </div>
    <div id="game-container">
      <div id="hud-container"></div>
      <div id="overlay-container"></div>
    </div>
    <div id="radio-container" style="margin-top: 24px;"></div>
  </div>

  <!-- =========================
       CORE SYSTEMS & LOADER
       ========================= -->
  <script src="systems/asset_manager.js"></script>
  <script src="systems/scene_manager.js"></script>
  <script src="systems/audio.js"></script>
  <script src="systems/game.js"></script>
  <script src="systems/narrative.js"></script>
  <script src="systems/ads.js"></script>
  <script src="ui/radio.js"></script>
  <script src="ui/credits.js"></script>
  <script src="ui/hud.js"></script>
  <script src="ui/shop.js"></script>
  <script src="assets-loader.js"></script>

  <!-- =========================
       INITIALIZATION
       ========================= -->
  <script>
    (function(global) {
      document.addEventListener('DOMContentLoaded', function() {
        if (global.loadAssets) {
          global.loadAssets('assets.json');
        } else {
           document.body.innerHTML = '<div style="color:red; text-align:center; padding-top:50px;"><h1>Fatal Error</h1><p>Asset loader not found.</p></div>';
        }
      });
    })(window);
  </script>

  <!-- =========================
       DEV TEST HARNESS
       ========================= -->
  <script>
  (function () {
    function hasDevFlag(){ try { return new URLSearchParams(location.search).get('dev') === '1'; } catch (e) { return false; } }
    if (!hasDevFlag()) return;

    function q(id){ return document.getElementById(id); }
    function btn(txt, fn){ var b=document.createElement('button'); b.className='uls-dev-btn'; b.textContent=txt; b.onclick=fn; return b; }

    var hudHTML = `
      <div id="uls-dev-hud" style="position:fixed;z-index:999999;right:12px;bottom:12px;width:360px;background:#0d0f12;color:#e6e8ec;font:11px/1.35 system-ui,Arial;border:1px solid #2a2f39;border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,.35);">
        <div id="uls-dev-head" style="padding:8px 10px;background:#151922;border-bottom:1px solid #242a35;cursor:move;font-weight:600;">ULS Dev Harness</div>
        <div id="uls-dev-body" style="padding:10px; display:flex; flex-direction:column; gap:8px;">
            <div class="sec" style="border:1px solid #222835;border-radius:6px;overflow:hidden"><div class="sec-t" style="background:#131825;color:#b9c0cc;padding:6px 8px;font-weight:600">Game Core</div><div class="sec-b" id="sec-game" style="padding:8px;display:flex;flex-wrap:wrap;gap:6px"></div></div>
            <div class="sec" style="border:1px solid #222835;border-radius:6px;overflow:hidden"><div class="sec-t" style="background:#131825;color:#b9c0cc;padding:6px 8px;font-weight:600">Scene</div><div class="sec-b" id="sec-scene" style="padding:8px;display:flex;flex-wrap:wrap;gap:6px"></div></div>
            <div class="sec" style="border:1px solid #222835;border-radius:6px;overflow:hidden"><div class="sec-t" style="background:#131825;color:#b9c0cc;padding:6px 8px;font-weight:600">Audio (SFX)</div><div class="sec-b" id="sec-sfx" style="padding:8px;display:flex;flex-wrap:wrap;gap:6px"></div></div>
        </div>
      </div>`;
    document.body.insertAdjacentHTML('beforeend', hudHTML);

    window.addEventListener('game:ready', function() {
        var gameSec = q('sec-game'), sceneSec = q('sec-scene'), sfxSec = q('sec-sfx');

        // Game Core Buttons
        gameSec.appendChild(btn('Start Tutorial', function(){ window.NarrativeManager.startSequence('tutorial'); }));
        gameSec.appendChild(btn('Open Shop', function(){ window.UI.Shop.show(); }));
        gameSec.appendChild(btn('Money +50', function(){ window.GameManager.modifyStat('money', 50); }));
        gameSec.appendChild(btn('Health -10', function(){ window.GameManager.modifyStat('health', -10); }));
        gameSec.appendChild(btn('Heat +1', function(){ window.GameManager.modifyStat('heat', 1); }));
        gameSec.appendChild(btn('Show Credits', function(){ window.UI.CreditsScreen.show(); }));

        // Scene Buttons
        sceneSec.appendChild(btn('City Day', function(){ window.SceneManager.setBackground('backgrounds.city.day.neon_core'); }));
        sceneSec.appendChild(btn('City Night', function(){ window.SceneManager.setBackground('backgrounds.city.night.neon_heights'); }));
        sceneSec.appendChild(btn('Apartment', function(){ window.SceneManager.setBackground('backgrounds.apartments.playerDefault'); }));

        // SFX Buttons
        sfxSec.appendChild(btn('UI Click', function(){ window.GameAudio.playSfx('ui_click'); }));
        sfxSec.appendChild(btn('Success', function(){ window.GameAudio.playSfx('success'); }));
        sfxSec.appendChild(btn('Ambience ON', function(){ window.GameAudio.playSfx('amb_city_street'); }));
        sfxSec.appendChild(btn('Ambience OFF', function(){ window.GameAudio.stopSfx('amb_city_street'); }));
    });
  })();
  </script>
</body>
</html>